name: SDK Sync CI

on:
  push:
    branches:
      - master

jobs:
  go:
    runs-on: ubuntu-latest
    if: ${{ startsWith(github.event.head_commit.message, 'sync') || (startsWith(github.event.head_commit.message, 'ci') && contains(github.event.head_commit.message, '#sdk')) }}
    steps:
      - uses: actions/checkout@v3
        with:
          path: core

      - uses: actions/checkout@v3
        with:
          path: sdk
          repository: ${{ github.repository_owner }}/kanthor-sdk-go
          token: ${{ secrets.KANTHOR_GITHUB_TOKEN }}

      - name: setup git config
        working-directory: sdk
        run: |
          git config user.name "Kanthor SDK Bot"
          git config user.email "<>"

      - name: sync openapi specs
        run: cp core/openapi/Sdk_swagger.yaml sdk/openapi.yaml

      - name: push
        working-directory: sdk
        run: |
          git add .
          git commit --allow-empty -m "ci($(date +%Y.%-m%d.%-H%M)): sync"; \
          git push origin;
